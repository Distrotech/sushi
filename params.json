{"name":"Sushi","tagline":"Apache Websocket Shell","body":"sushi\r\n=====\r\n\r\nSetUid SHell Interactive - Apache Websocket Shell\r\n\r\nusing the apache websocket module create a shell plugin that can allow users / admin to open a shell\r\nin a VT100 javascript popup.\r\n\r\nThe following vt100 javascript package works out the box and is a fork of shellinabox<BR>\r\nhttp://wasd.vsm.com.au/wasd_root/src/dclinabox/readmore.html\r\n\r\nthey include a websock library and daemon that i aim to replace.\r\n\r\nUsing the apache-websockts module the dumb protocol i plan to implement the code into a plugin.</BR>\r\nhttps://github.com/disconnect/apache-websocket\r\n\r\nthe plugin needs to create a thread, fork a pty running a shell and pass communication from the web socket to the pty.\r\n\r\nsushi is a setuid wrapper similaer in purpose to suexec but with the purpose of been a \"getty\" it authenticates\r\nthe user against PAM and spawns login \"pre authenticated\" allowing better control of the process.\r\n\r\nthe wrapper is setuid/setgid [chmod 6755] and performs the following</BR>\r\n<UL>\r\n<LI>Authenticate the user [account/session should be opened not yet]</LI>\r\n<LI>Make sure there is a passwd ent for the user authenticating</LI>\r\n<LI>Initialise the groups to that of the user loging in</LI>\r\n<LI>Some *BLACK MAGIC* if the user is a member of a SU group allow him SU access [sudo sh]</Li>\r\n<LI>Set the ruid/guid to that of the user [possibly SU see 4]</LI>\r\n<LI>chdir to the users home dir</LI>\r\n</UL>\r\n\r\nif any of these except for 4 fail the wrapper will fail this is not as \"strict\" as suexec nor is needed to be,\r\nwe are authenticating the user.\r\n\r\non success login is forked/exec we should be passing the host info and enviroment one day\r\nwaitpid will get the result code and return with it.\r\n\r\nsushipty\r\n========\r\n\r\nthis is a scratch pad app eventually to be moved into a apache websockets plugin it runs sushi with forkpty\r\nit puts STDIN into RAW mode sets the pty size to that of STDOUT.\r\n\r\ntwo threads are used for IO in blocking mode as opposed to using select/O_NONBLOCK for one having std... in \r\nnon blocking is a plan spawned by satan and we only require one thread when its put into a apache websocket plugin.\r\n\r\nideally as the functions are the same we could call the same function for both threads with appropriate *pvt.\r\n\r\nsushipty accepts username and password as args that it passes to sushi these are optional and at least the password\r\nis stupid to pass on the command line.\r\n\r\nthat said stupid is as stupid does .... so the command line of sushipty and sush is bodged so that all args vanish\r\nas soon as possible.\r\n\r\nthe password should be passed via stdin and will be done automagically if basic auth is used for the /location in\r\napache.\r\n\r\nthis is very much WIP/RFC\r\n\r\nbuilding\r\n========\r\n\r\nautotools have been added for convinence please note its a \"basic\" setup.</br>\r\nyou need to be root to install [chown/chmod] use \"sudo make install\"\r\n\r\n./configure && make && sudo make install\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}